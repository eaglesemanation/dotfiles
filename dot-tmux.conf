# Speed up ESC passthrough from tmux to internal commands
set -s escape-time 10
# Enable mouse support
set -g mouse on
# Start tabs from 1, to match keyboard layout
set -g base-index 1
setw -g pane-base-index 1
# Display command timeout
set -g display-time 4000
# Scrollback buffer
set -g history-limit 50000
# Status bar refresh frequency
set -g status-interval 2
# Mode for [prefix + :]. Vi mode treats the command as a buffer
# not consistent with actual Vi behaviour
set -g status-keys emacs
# Support for more colors
set -g default-terminal "screen-256color"
# Allow detecting when terminal window is focused
set -g focus-events on
# Something about multiple windows connected to the same session
setw -g aggressive-resize on
# Put status bar at the top to separate from nvim one
set -g status-position top
# Allows use of control characters outside of standard 32 ASCII chars
set -g extended-keys on

## COLORSCHEME: everforest dark medium
set -g @everforest_bg_dim '#1e2326'
set -g @everforest_bg0 '#272e33'
set -g @everforest_bg1 '#2e383c'
set -g @everforest_bg2 '#374145'
set -g @everforest_bg3 '#414b50'
set -g @everforest_bg4 '#495156'
set -g @everforest_bg5 '#4f5b58'
set -g @everforest_bg_visual '#4c3743'
set -g @everforest_bg_red '#493b40'
set -g @everforest_bg_green '#3c4841'
set -g @everforest_bg_blue '#384b55'
set -g @everforest_bg_yellow '#45443c'

set -g @everforest_fg '#d3c6aa'
set -g @everforest_red '#e67e80'
set -g @everforest_orange '#e69875'
set -g @everforest_yellow '#dbbc7f'
set -g @everforest_green '#a7c080'
set -g @everforest_aqua '#83c092'
set -g @everforest_blue '#7fbbb3'
set -g @everforest_purple '#d699b6'
set -g @everforest_grey0 '#7a8478'
set -g @everforest_grey1 '#859289'
set -g @everforest_grey2 '#9da9a0'
set -g @everforest_statusline1 '#a7c080'
set -g @everforest_statusline2 '#d3c6aa'
set -g @everforest_statusline3 '#e67e80'

set -g mode-style fg='#{@everforest_purple}',bg='#{@everforest_bg_red}'
set -g pane-border-style fg='#{@everforest_bg1}'
set -g pane-active-border-style fg='#{@everforest_blue}'
set -g message-style fg='#{@everforest_statusline3}',bg='#{@everforest_bg_dim}'
set -g message-command-style fg='#{@everforest_bg3}',bg='#{@everforest_bg1}'

setw -g window-status-style fg='#{@everforest_bg5}',bg='#{@everforest_bg0}'
setw -g window-status-activity-style bg='#{@everforest_bg1}',fg='#{@everforest_bg3}'
setw -g window-status-current-style fg='#{@everforest_fg}',bg='#{@everforest_bg_green}'
set -g window-status-format "#[fg=#{@everforest_bg0},bg=#{@everforest_bg_dim}]#[fg=#{@everforest_grey0},bg=#{@everforest_bg0}] #I │ #[fg=#{@everforest_grey0},bg=#{@everforest_bg0}]#W #[fg=#{@everforest_bg0},bg=#{@everforest_bg_dim}]"
set -g window-status-current-format "#[fg=#{@everforest_bg_green},bg=#{@everforest_bg_dim}]#[fg=#{@everforest_fg},bg=#{@everforest_bg_green}] #I │ #[fg=#{@everforest_fg},bg=#{@everforest_bg_green},bold]#W #[fg=#{@everforest_bg_green},bg=#{@everforest_bg_dim},nobold]"

set -g status-style fg='#{@everforest_fg}',bg='#{@everforest_bg_dim}',default
set -g status-left-length 60
set -g status-left '#[fg=#{@everforest_green}]#[fg=#{@everforest_bg_dim},bg=#{@everforest_green},bold] #S #[fg=#{@everforest_green},bg=#{@everforest_bg2}] #(whoami) #[fg=#{@everforest_bg2},bg=#{@everforest_bg_dim},nobold] '
set -g status-right-length 150
set -g status-right ' #[fg=#{@everforest_bg2}]#[fg=#{@everforest_fg},bg=#{@everforest_bg2}] #[fg=#{@everforest_fg},bg=#{@everforest_bg2}]%Y-%m-%d │ %H:%M #[fg=#{@everforest_bg_dim},bg=#{@everforest_aqua},bold] #h #[fg=#{@everforest_aqua},bg=#{@everforest_bg_dim},nobold]'
## END COLORSCHEME

bind -n M-\\ split-window -h
bind -n 'M--' split-window -v

bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

bind -n M-p previous-window
bind -n M-n next-window

# Unlock top level session
bind -n -T locked-mode M-g \
	set -g prefix C-b \; \
	set -g key-table root \; \
	set -g status-left '#[fg=#{@everforest_green}]#[fg=#{@everforest_bg_dim},bg=#{@everforest_green},bold] #S #[fg=#{@everforest_green},bg=#{@everforest_bg2}] #(whoami) #[fg=#{@everforest_bg2},bg=#{@everforest_bg_dim},nobold] ' \; \
	set -g status-right ' #[fg=#{@everforest_bg2}]#[fg=#{@everforest_fg},bg=#{@everforest_bg2}] #[fg=#{@everforest_fg},bg=#{@everforest_bg2}]%Y-%m-%d │ %H:%M #[fg=#{@everforest_bg_dim},bg=#{@everforest_aqua},bold] #h #[fg=#{@everforest_aqua},bg=#{@everforest_bg_dim},nobold]'

# Lock top level session to access a nested one
bind -n M-g \
	set -g prefix None \; \
	set -g key-table locked-mode \; \
	set -g status-left '#[fg=#{@everforest_bg_yellow}]#[fg=#{@everforest_yellow},bg=#{@everforest_bg_yellow}] Locked #[fg=#{@everforest_bg_yellow},bg=#{@everforest_bg_dim},nobold] ' \; \
	set -g status-right ' #[fg=#{@everforest_bg2}]#[fg=#{@everforest_fg},bg=#{@everforest_bg2}] #[fg=#{@everforest_fg},bg=#{@everforest_bg2}]%Y-%m-%d │ %H:%M #[fg=#{@everforest_aqua},bg=#{@everforest_bg_blue},bold] #h #[fg=#{@everforest_bg_blue},bg=#{@everforest_bg_dim},nobold]'

bind r source-file ~/.tmux.conf \; display 'Reloaded'
